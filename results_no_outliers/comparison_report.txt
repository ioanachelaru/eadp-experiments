================================================================================
COMPARISON REPORT: With Outliers vs Without Outliers
K-Means Clustering Analysis (k=2)
================================================================================

This report compares the clustering results before and after removing outliers
(samples with any feature having |Z-score| > 3).

================================================================================
SUMMARY TABLE
================================================================================

                              |     ANT DATASET      |   CALCITE DATASET
                              |  With    | Without   |  With    | Without
------------------------------|----------|-----------|----------|----------
Samples                       |   2238   |   2008    |  19752   |  19091
Outliers Removed              |     0    |    230    |     0    |    661
Defective Instances           |    177   |    114    |   1577   |   1445
Defect Ratio                  |   7.9%   |   5.7%    |   8.0%   |   7.6%
------------------------------|----------|-----------|----------|----------
CLUSTER SIZES                 |          |           |          |
  Cluster 0                   |   2237   |   1993    |  19751   |  19044
  Cluster 1                   |      1   |     15    |      1   |     47
  Minority %                  |   0.04%  |   0.75%   |   0.01%  |   0.25%
------------------------------|----------|-----------|----------|----------
INTERNAL METRICS              |          |           |          |
  Silhouette Score            | 0.9948   | 0.7259    | 0.9993   | 0.8534
  Davies-Bouldin Index        | 0.0028   | 0.4978    | 0.0003   | 0.4084
------------------------------|----------|-----------|----------|----------
EXTERNAL METRICS              |          |           |          |
  Homogeneity                 | 0.0001   | 0.0020    | 0.0000   | 0.0007
  Completeness                | 0.0095   | 0.0100    | 0.0076   | 0.0112
  V-Measure                   | 0.0003   | 0.0033    | 0.0000   | 0.0014


================================================================================
KEY OBSERVATIONS
================================================================================

1. CLUSTER BALANCE IMPROVED
   - Ant: Minority cluster grew from 1 sample to 15 samples (15x improvement)
   - Calcite: Minority cluster grew from 1 sample to 47 samples (47x improvement)
   - Clusters are still imbalanced but now contain meaningful groups

2. INTERNAL METRICS CHANGED SIGNIFICANTLY
   - Silhouette Score decreased (Ant: 0.99 -> 0.73, Calcite: 0.99 -> 0.85)
   - This is expected: the artificially high scores were due to single outliers
   - New scores are more realistic and interpretable
   - Davies-Bouldin increased but remains reasonable (<1.0)

3. EXTERNAL METRICS IMPROVED SLIGHTLY
   - V-Measure improved ~10x for Ant (0.0003 -> 0.0033)
   - V-Measure improved ~47x for Calcite (0.00003 -> 0.0014)
   - Still very low, indicating clusters don't align with defect labels

4. OUTLIER REMOVAL IMPACT
   - Ant: 230 samples removed (10.3% of data)
   - Calcite: 661 samples removed (3.3% of data)
   - Some defective instances were removed with outliers


================================================================================
TOP 10 RELEVANT FEATURES COMPARISON
================================================================================

ANT DATASET
-----------
Rank | With Outliers                          | Without Outliers
-----|----------------------------------------|----------------------------------------
  1  | MOSER_age (47.31)                      | PMD_ctcnse (2.10)
  2  | PMD_rule_type_design rules (47.31)     | PMD_rule_type_clone impl. (1.59)
  3  | PMD_severity_minor (47.31)             | PMD_clmmic (1.23)
  4  | PMD_severity_major (47.28)             | PMD_rule_type_type res. (0.34)
  5  | PMD_rule_type_optimization (47.28)     | PMD_rule_type_jakarta (0.07)
  6  | PMD_rule_type_jakarta (47.27)          | PMD_severity_major (0.07)
  7  | PMD_rule_type_strict exc. (47.27)      | PMD_pst (0.07)
  8  | PMD_if (47.27)                         | PMD_atret (0.04)
  9  | MOSER_authors (47.26)                  | PMD_gdl (0.03)
 10  | PMD_rule_type_naming (47.25)           | PMD_uc (0.02)

CALCITE DATASET
---------------
Rank | With Outliers                          | Without Outliers
-----|----------------------------------------|----------------------------------------
  1  | MOSER_age (140.54)                     | PMD_pci (2.96)
  2  | HASSAN_edhcm (140.54)                  | PMD_rule_type_clone impl. (1.32)
  3  | HASSAN_lgdhcm (140.54)                 | PMD_ctcnse (0.84)
  4  | HASSAN_ldhcm (140.54)                  | PMD_apmp (0.46)
  5  | MOSER_authors (140.54)                 | PMD_clmmic (0.38)
  6  | HASSAN_hcm (140.54)                    | PMD_ccom (0.34)
  7  | PMD_severity_minor (140.54)            | PMD_rule_type_type res. (0.26)
  8  | MOSER_revisions (140.54)               | PMD_casr (0.25)
  9  | PMD_rule_type_design (140.53)          | PMD_loc (0.22)
 10  | ISSUE_major_bug (140.53)               | PMD_aisd (0.18)


================================================================================
COMMON TOP FEATURES (WITHOUT OUTLIERS)
================================================================================

Features appearing in top 10 for BOTH Ant and Calcite after outlier removal:

1. PMD_rule_type_clone implementation rules
   - Ant rank: 2 (relevance: 1.59)
   - Calcite rank: 2 (relevance: 1.32)

2. PMD_ctcnse
   - Ant rank: 1 (relevance: 2.10)
   - Calcite rank: 3 (relevance: 0.84)

3. PMD_clmmic
   - Ant rank: 3 (relevance: 1.23)
   - Calcite rank: 5 (relevance: 0.38)

4. PMD_rule_type_type resolution rules
   - Ant rank: 4 (relevance: 0.34)
   - Calcite rank: 7 (relevance: 0.26)

These clone-related and type resolution PMD metrics consistently differentiate
clusters across both projects.


================================================================================
CONCLUSIONS
================================================================================

1. OUTLIER REMOVAL WAS NECESSARY
   The original analysis was dominated by single extreme outliers, producing
   misleading metrics (Silhouette ~0.99). After removal, clusters are more
   meaningful with 15-47 samples in minority clusters.

2. CLUSTERS STILL DON'T ALIGN WITH DEFECTS
   External metrics remain very low (V-measure < 0.01), indicating that
   K-Means clustering does not naturally separate defective from non-defective
   classes. The clusters are based on other patterns in the code metrics.

3. CLONE-RELATED METRICS ARE MOST DISTINCTIVE
   After removing outliers, PMD clone detection metrics (ctcnse, clmmic,
   clone implementation rules) emerge as the most relevant features for
   distinguishing clusters - consistently across both projects.

4. RECOMMENDATIONS FOR FUTURE ANALYSIS
   - Consider supervised learning methods for defect prediction
   - Try different numbers of clusters (k=3, 4, 5)
   - Apply feature selection before clustering
   - Use density-based clustering (DBSCAN) to handle remaining outliers

================================================================================
END OF COMPARISON REPORT
================================================================================
